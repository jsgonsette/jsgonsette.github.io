<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Jean-Sébastien Gonsette  | Pendule inversé, part 3</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.75.1" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    <link href='https://jsgonsette.github.io/dist/main.css' rel='stylesheet' type="text/css" />
    <link href='https://jsgonsette.github.io/css/jsg.css' rel='stylesheet' type="text/css" />
    <link href='https://jsgonsette.github.io/css/socialSharing.css' rel='stylesheet' type="text/css" />
    
      
    

    

    <meta property="og:title" content="Pendule inversé, part 3" />
<meta property="og:description" content="Station de Contrôle PC, fabrication, assemblage, mise en route" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jsgonsette.github.io/projects/ipendulum/part3/" />

<meta itemprop="name" content="Pendule inversé, part 3">
<meta itemprop="description" content="Station de Contrôle PC, fabrication, assemblage, mise en route">

<meta itemprop="wordCount" content="3304">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pendule inversé, part 3"/>
<meta name="twitter:description" content="Station de Contrôle PC, fabrication, assemblage, mise en route"/>

      
    
  </head>

  <body class="ma0 avenir bg-near-white">

    

  
  
  <header class="cover bg-top" style="background-image: url('https://jsgonsette.github.io/images/iPendulum/Part3.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://jsgonsette.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Jean-Sébastien Gonsette
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/42/" title="42 page">
              42
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/enigmes/" title="Énigmes page">
              Énigmes
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Billets page">
              Billets
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/projects/" title="Projets page">
              Projets
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="À propos page">
              À propos
            </a>
          </li>
          
        </ul>
      
      






  <a href="https://www.linkedin.com/in/jsgonsette/" class="link-transition linkedin link dib z-999 pt3 pt0-l mr2" title="LinkedIn link">
    <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

  </a>


  <a href="https://github.com/jsgonsette" class="link-transition github link dib z-999 pt3 pt0-l mr2" title="Github link">
    <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

  </a>


    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Pendule inversé, part 3</h1>
        
          <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
            Station de Contrôle PC, fabrication, assemblage, mise en route
          </h2>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <p class="f6 b helvetica tracked">
          
            iPendulum
          
        </p>
        <h1 class="f1">
          Pendule inversé, part 3
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
        <span class="justified">
        <blockquote>
<p>Nous voici déjà aux termes de cette série d’articles consacrée à la réalisation d’un pendule inversé. J’espère avoir réussi à susciter votre intérêt pour le sujet malgré le fait que les concepts théoriques et mathématiques sous-jacents peuvent sembler austères. Ce dernier article est beaucoup plus pragmatique et a pour but de vous guider dans l’assemblage et la mise en route de votre propre pendule.</p>
</blockquote>
<!-- raw HTML omitted -->
<p>



  


<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="/js/load-photoswipe.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</p>
<h2 id="assemblage-du-pcb">Assemblage du PCB</h2>
<p>Les dimensions plutôt restreintes du pendule font que l’encombrement du circuit imprimé constitue une contrainte majeure. Celui-ci est donc assemblé avec des composants CMS sur les deux faces. Le deuxième souci vient des deux capteurs : l’accéléromètre et le gyroscope. Ce genre de composants n’existe tout simplement pas dans des boîtiers autres que LGA (Land Grid Array), autrement dit, ils n’ont pas de pattes soudables au fer à souder et le passage au four est obligatoire. Pour toutes ces raisons, ne vous lancez dans l’assemblage manuel que si vous savez parfaitement ce que vous faites. Dans le cas contraire, une autre possibilité revient à faire comme moi et à demander au fabricant du PCB de les douder directement pour vous.</p>
<p>Le micrologiciel se programme dans le microcontrôleur via le connecteur J200 avec le binaire fourni. Ce micrologiciel se recompile facilement à l’aide de l’environnement MPLAB X de Microchip et grâce au code source que vous trouverez également sur GitHub.</p>
<h2 id="test-du-circuit-imprimé">Test du circuit imprimé</h2>
<p>Le circuit imprimé peut être facilement testé avant même de le monter mécaniquement dans le pendule. Pour cela, alimentez-le avec une tension entre 6 et 9V sur son connecteur J300, ou connectez-lui simplement sa batterie LIPO. Une fois sous tension, la LED 301 doit s’allumer pour signaler la présence de l’alimentation. Le programme vérifie ensuite qu’il peut bien communiquer avec l’accéléromètre et avec le gyroscope. En cas de problème la LED 200 clignote en rouge, par intermittence de 3 ou 4 pulsations selon le capteur en défaut. Si le moteur n’est pas connecté au circuit imprimé, le programme le détecte également et signale l’erreur en clignotant par intermittence de 2 pulsations.</p>
<p>Vous pouvez ensuite connecter le moteur au circuit imprimé via le connecteur J100, comme indiqué sur la photo ci dessous. Prenez le moteur en main par son stator et mettez la tension. Le moteur doit se mettre à tourner brièvement et, si tout se passe bien, la LED 200 ne devrait pas se mettre à clignoter.</p>

<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/Electronic_02.jpg" alt="Insérer la nappe moteur dans le connecteur J100. A la mise sous tension du PCB, le moteur doit tourner brièvement."/>
    </div>
    <a href="/images/iPendulum/Electronic_02.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Insérer la nappe moteur dans le connecteur J100. A la mise sous tension du PCB, le moteur doit tourner brièvement.</p>
      </figcaption>
  </figure>
</div>

<h2 id="inventaire-des-composants">Inventaire des composants</h2>
<p>L’assemblage du pendule est une étape aisée une fois que l’on dispose de toutes les pièces requises. Nous allons dès lors commencer par faire l’inventaire de tout ce dont vous avez besoin. Le premier élément est bien sûr un circuit imprimé fonctionnel, mais à ce stade cela devrait être réglé. Le deuxième élément  est une batterie LIPO 2S dont les dimensions doivent être de 5 sur 3 sur 1 cm. Celle sélectionnée pour le projet porte la référence 7,4V Lipo 2S 30C 450mah chez TeamOrion. Elle ne semble plus être disponible, donc voici un <a href="https://www.guixmodel.fr/modelisme/accus-et-chargeurs/accus/lipo-2s/accu-lipo-450mah-2s-30c-kryptonium-detail">équivalent</a> possible. L&rsquo;important est que la tension et les dimensions soient identiques, le reste n&rsquo;est pas important.</p>
<!-- raw HTML omitted -->
<p>Le câble d’alimentation de cette batterie se termine par un connecteur JST-RCY (qui, pour une raison qui m’échappe, est appelé connecteur BEC dans le jargon un peu brumeux des modélistes). Comme ce type de connecteur n’existe pas en version soudable sur circuit imprimé, il est nécessaire de fabriquer un petit adaptateur pour passer du connecteur JST-RCY de la batterie au connecteur JST-XH du circuit imprimé. Il existe des pinces très onéreuses pour assembler en un tour de main le fil, le connecteur en plastique et les terminaisons métalliques. Elles ont aussi la fâcheuse tendance de n’être compatible qu’avec un seul type de connecteur. Je vous conseille donc vivement d’assembler les connecteurs à la main et au fer à souder. Cela prend certes plus de temps, mais pour la fabrication d’un seul câble ce n’est pas vraiment un problème.</p>
<p>Vous avez ensuite besoin de trois pièces en plastique : une demi-coque servant de support au moteur, une demi-coque servant de support au circuit imprimé, ainsi que le moyeu de la roue d’inertie. Le fichier binaire de ces pièces est fourni ici et peut être utilisé pour les imprimer grâce à une imprimante 3D. En ce qui me concerne, je suis passé par le site <a href="http://www.sculpteo.com">Sculpteo</a> et j’ai choisi comme matériau le plastique blanc de base.</p>
<p>Vous avez bien sûr aussi besoin d’un moteur. Celui-ci est un moteur sans balais de chez Maxon de la série EC 45 Flat. Le très gros avantage de ce moteur vient de sa forme relativement plate qui le rend parfait pour le glisser dans le pendule sans que ce dernier ne prenne une dimension démesurée. Sa référence exacte porte le numéro <a href="https://www.maxonmotor.com/maxon/view/product/200142">200142</a>.</p>
<!-- raw HTML omitted -->
<p>Vous avez également besoin d’un anneau métallique qui va servir à donner sa masse à la roue d’inertie. Durant la conception, j’ai essayé d’éviter d’avoir à usiner une pièce compliquée en métal. Pour ce faire, je suis parti du principe que la partie complexe de la roue pourrait être imprimée en plastique, tandis que le pourtour extérieur pouvait être un simple anneau métallique. Celui-ci doit avoir les dimensions suivantes : diamètre extérieur de 55mm, diamètre intérieur de 48mm et épaisseur de 10mm. Un tel anneau peut être commandé sur le site <a href="https://fr.misumi-ec.com/">misumi</a> et porte la référence <strong>AWSM-D-D55-V48-T10</strong>.</p>
<p>Enfin il vous faut un peu de visserie pour assembler toutes les pièces ensemble.  Trois vis M3 de 6mm sont nécessaires pour fixer le moteur, tandis que sept autres vis pour plastique serviront à fixer le circuit imprimé et assembler les coques du pendule.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/Inventory.png" alt="Les différents ingrédients à réunir pour la rectte du pendule inversé (roue d&#39;inertie déjà montée sur cette photo)."/>
    </div>
    <a href="/images/iPendulum/Inventory.png" itemprop="contentUrl"></a>
      <figcaption>
          <p>Les différents ingrédients à réunir pour la rectte du pendule inversé (roue d&#39;inertie déjà montée sur cette photo).</p>
      </figcaption>
  </figure>
</div>

<h2 id="assemblage-du-pendule">Assemblage du pendule</h2>
<p>La roue d’inertie est l’élément qui demande le plus d’attention. Premièrement il est nécessaire de sertir l’anneau métallique autour de l’axe en plastique. En principe les dimensions doivent correspondre et un serrage à l’étau est suffisant pour les fixer ensemble définitivement. Si le serrage est trop fort, un petit coup de lime sur l’axe en plastique devrait régler le problème. Dans le cas contraire, quelques points de super glue devraient également résoudre le souci si le serrage est trop lâche. Ensuite, il est nécessaire de repercer le trou central de l’axe en plastique afin que l’axe moteur puisse y être inséré. Veillez à bien réaliser cette opération en étant le plus droit possible, en utilisant une perceuse à colonne par exemple.  Tout déséquilibre se traduira par un balourd lorsque la roue sera en rotation. La mèche doit percer un trou de 4mm de diamètre. Je vous conseille de tester votre mèche dans un autre support avant de réaliser cette opération, afin de vérifier que le trou ne soit ni trop étroit, ni trop serré, pour y glisser l’axe du moteur.</p>
<p>Fixez maintenant le moteur dans la coque en plastique à l’aide des trois vis prévues à cet effet. Veillez à faire passer la nappe de câble à travers le trou de la coque, comme indiqué sur la première des photos qui suivent. Insérez maintenant la roue d’inertie sur l’axe dans le sens illustré sur la deuxième photo.  Veillez à bien faire pression sur l’axe central du moteur pour cette opération, et pas sur le pourtour extérieur, afin de ne pas voiler le moteur. Si ça ne rentre pas, agrandissez un peu le trou. Dans tous les cas, il est intéressant de fixer la roue sur l&rsquo;axe avec un peu de colle afin d&rsquo;empêcher tout glissement. Il est important qu&rsquo;elle soit bien maintenue afin que le pendule puisse effectuer des sauts convenablement.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/FixMotor.jpg" alt="Fixation du moteur dans la coque. Attention à bien positioner la nappe."/>
    </div>
    <a href="/images/iPendulum/FixMotor.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Fixation du moteur dans la coque. Attention à bien positioner la nappe.</p>
      </figcaption>
  </figure>
</div>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/FixWheel.jpg" alt="Fixation du de la roue d&#39;inertie sur l&#39;axe moteur."/>
    </div>
    <a href="/images/iPendulum/FixWheel.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Fixation du de la roue d&#39;inertie sur l&#39;axe moteur.</p>
      </figcaption>
  </figure>
</div>

<p>Les étapes un peu délicates étant maintenant derrière vous, vous pouvez visser  le circuit imprimé dans la coque prévue à cet effet avec 4 des vis pour plastique. Ajoutez lui également le câble de connexion à la batterie (figure ci-dessous).</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/PCBinTheShell.jpg" alt="Fixation du PCB dans sa coque."/>
    </div>
    <a href="/images/iPendulum/PCBinTheShell.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Fixation du PCB dans sa coque.</p>
      </figcaption>
  </figure>
</div>

<p>L’étape finale consiste à rassembler les deux moitiés du pendule ensemble. Pour ce faire, commencez par insérer la nappe de câble du moteur dans le connecteur J100 du PCB, dans le même sens que montré sur la photo qui suit. Vissez ensuite les deux coques avec les 3 dernières vis pour plastique.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/TwoShells.jpg" alt="Les deux demi-coques avant l&#39;assemblage final."/>
    </div>
    <a href="/images/iPendulum/TwoShells.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Les deux demi-coques avant l&#39;assemblage final.</p>
      </figcaption>
  </figure>
</div>

<p>Félicitations, votre pendule est maintenant complètement assemblé et prêt à l’emploi. Pour que tout soit complet, il ne vous reste plus qu’à glisser une batterie LIPO chargée dans l’emplacement prévu à cet effet derrière le circuit imprimé, comme illustré à la photo ci-dessous.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/PendulumFinal.jpg" alt="Le pendule une fois complètement assemblé."/>
    </div>
    <a href="/images/iPendulum/PendulumFinal.jpg" itemprop="contentUrl"></a>
      <figcaption>
          <p>Le pendule une fois complètement assemblé.</p>
      </figcaption>
  </figure>
</div>

<h2 id="mise-en-route">Mise en route</h2>
<p>Le pendule ne tente de s’équilibrer ou de sauter que lorsqu’il est correctement orienté, c&rsquo;est-à-dire quand l’axe autour duquel il pivote est en contact avec le sol. Par contre si le moteur est orienté vers le bas ou vers le haut, le pendule se met en attente. Positionnez-le donc sur le flanc gauche ou droit et actionnez l’interrupteur. Après cinq secondes d’immobilité dans cette position, le pendule considère qu’il peut tenter de réaliser un saut. Il doit donc accélérer sa roue d’inertie puis la bloquer afin de basculer dans sa position d’équilibre. Vous pouvez aussi le placer directement en équilibre en le soulevant manuellement depuis sa position de repos. Dès que l’angle du pendule est suffisant, le moteur délivre le couple nécessaire pour remonter seul à son point d’équilibre. Si vous déséquilibrez le pendule, celui-ci tentera de rattraper le coup autant que possible. Au-delà d’un certain point cependant, il devra bien capituler et retombera sur le flanc. Il retentera alors un saut après les cinq secondes d’immobilité nécessaires.</p>
<h2 id="fonctionnement-des-led">Fonctionnement des LED</h2>
<p>Le PCB du pendule dispose de trois petites LED, rouge, jaune et verte, qui permettent de visualiser de façon très sommaire ce que le pendule est en train de réaliser. Celle la plus importante est sans conteste la LED rouge car c’est elle qui indique les erreurs critiques empêchant le pendule de fonctionner normalement. Une telle erreur se traduit par un clignotement de cette LED rouge selon un motif qui dépend de l’erreur rencontrée:</p>
<ul>
<li>Un simple clignotement signifie que la tension batterie est trop faible.</li>
<li>Un clignotement par groupe de deux signifie que le moteur n’est pas détecté.</li>
<li>Un clignotement par groupe de trois ou quatre signifie que le processeur ne parvient pas à dialoguer avec le gyroscope ou les accéléromètres, respectivement.</li>
</ul>
<p>Lorsque le pendule fonctionne normalement, il peut être dans plusieurs états possibles. Le premier est l’attente d’un positionnement stable avant d’effectuer un saut. Dans ce cas aucune LED n’est allumée. Lorsque le pendule est prêt à faire un saut et accélère sa roue d’inertie, il le manifeste en affichant un chenillard se déplaçant dans la direction du saut. Enfin, seule la LED verte clignote lorsque le pendule maintient son équilibre.</p>
<h2 id="connexion-à-la-station-sol">Connexion à la station sol</h2>
<p>Le logiciel <em>iPendulum Control Station</em> est un petit programme réalisé en C# et tournant sous Windows. Il est destiné à se connecter à la liaison série du pendule afin de collecter toutes sortes d’informations sur l’état du micrologiciel, ainsi qu’à réaliser le calibrage de ses organes internes. Ce programme ne prend réellement son sens qu’à des fins de diagnostic, ou durant le développement du pendule lui-même, pour obtenir des informations en temps réel de ce qu’il se passe à l’intérieur. Ce programme et son code source sont disponibles sur GitHub dans le sous répertoire <code>Software</code></p>
<p>Une fois le programme lancé, allez dans le menu <em>« Tools-&gt;Connect »</em>. Choisissez le numéro de port COM auquel est connecté le pendule et établissez la connexion. Si tout se passe bien, la boîte de dialogue de connexion disparaît et l’écran principal du programme laisse tomber le gris pour s’afficher en couleur. Cet écran affiche une représentation stylisée du pendule et de l’angle qu’il fait avec le sol. Différents onglets sont disponibles dans le bas de la page. Par défaut, l’écran principal est sélectionné et affiche les informations en temps réel du pendule. Un deuxième écran affiche des graphiques contenant l’historique des différentes variables, tandis qu’un troisième permet de sélectionner dans quel fichier de configuration écrire les données collectées du pendule.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/CSNotConnected.png" alt="Aperçu du logiciel iPendulum Control Station avant la connexion avec le pendule. L&#39;affichage est grisé."/>
    </div>
    <a href="/images/iPendulum/CSNotConnected.png" itemprop="contentUrl"></a>
      <figcaption>
          <p>Aperçu du logiciel iPendulum Control Station avant la connexion avec le pendule. L&#39;affichage est grisé.</p>
      </figcaption>
  </figure>
</div>

<h2 id="description-de-lapplication">Description de l’application</h2>
<p>L’écran principal affiche une vue du pendule avec l’orientation qu’il présente dans le monde réel. Faites bouger le pendule à la main et vous pourrez le voir bouger à l’écran de la même façon. Le volet de gauche de l’écran principal contient un arbre que vous pouvez dérouler afin d’observer l’état complet du pendule en temps réel.</p>
<ul>
<li>Le nœud <em>« Operating System »</em> contient des informations spécifiques au RTOS : version, utilisation de la mémoire, tâches, pourcentage d’utilisation du CPU.</li>
<li>Le nœud <em>« Système »</em> affiche des informations générales sur le micrologiciel.</li>
<li>Le nœud <em>« battery »</em> donne la tension de la batterie et son état de charge.</li>
<li>Le nœud <em>« Sensors »</em> contient les données brutes retournées par les capteurs.</li>
<li>Le nœud « Motor » indique le couple délivré par le moteur.</li>
<li>Enfin le nœud <em>« State »</em> affiche l’état du pendule tel qu’estimé par le filtre de Kalman.</li>
</ul>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/CSConnected.png" alt="Aperçu du logiciel iPendulum Control Station une fois la connexion au pendule établie. La fenêtre de gauche affiche un arbre grâce auquel il est possible d&#39;explorer l&#39;état interne du pendule."/>
    </div>
    <a href="/images/iPendulum/CSConnected.png" itemprop="contentUrl"></a>
      <figcaption>
          <p>Aperçu du logiciel iPendulum Control Station une fois la connexion au pendule établie. La fenêtre de gauche affiche un arbre grâce auquel il est possible d&#39;explorer l&#39;état interne du pendule.</p>
      </figcaption>
  </figure>
</div>

<p>Sélectionnez maintenant l’onglet <em>« Scopes »</em> afin d’afficher l’historique des télémétries remontées par le pendule. Quatre graphes se présentent à vous. Celui en haut à gauche est consacré à l’état estimé du pendule. Son voisin de droite affiche les informations concernant le moteur : couple délivré et vitesse. En bas à gauche vous trouverez les informations retournées par l’accéléromètre et le gyroscope. Enfin, le dernier graphique affiche la vitesse brute mesurée par le contrôleur moteur. Cette vitesse est toujours positive, quel que soit le sens de rotation du moteur, car le contrôleur ne peut physiquement pas distinguer l’un ou l’autre cas. Tous les graphiques sont rafraîchis dynamiquement en fur et à mesure de l’arrivée des données. Vous pouvez zoomer avec la roulette de la souris ou les boutons dédiés sur la gauche de l’écran. Vous pouvez également faire défiler les graphiques, soit avec la barre de défilement horizontale, soit en cliquant dans un graphique et en déplaçant la souris. Les quatre graphiques sont synchronisés entre eux et affichent toujours la même fenêtre temporelle.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/CSGraphs.png" alt="L&#39;onglet Scopes dessine les courbes de relevé des capteurs en temps réel."/>
    </div>
    <a href="/images/iPendulum/CSGraphs.png" itemprop="contentUrl"></a>
      <figcaption>
          <p>L&#39;onglet Scopes dessine les courbes de relevé des capteurs en temps réel.</p>
      </figcaption>
  </figure>
</div>

<p>Si vous vous rendez dans l’onglet <em>« Log »</em>, vous pourrez spécifier un fichier dans lequel stocker le contenu complet du dialogue qui a lieu entre l’application et le pendule. Choisissez un fichier et cliquez ensuite sur <em>« Start Logging »</em> pour démarrer l’enregistrement.</p>
<h2 id="calibration-de-la-batterie">Calibration de la batterie</h2>
<p>La tension délivrée par la batterie fait partie des mesure remontées par le pendule. Celle-ci permet de se faire une idée de son état de charge et ainsi d’éviter que la tension n’atteigne le seuil critique en dessous duquel la batterie LIPO pourrait être endommagée. Ce seuil est d’environ 3,7 Volts par cellule, soit 7,4 Volts dans notre cas. La chaine de mesure de cette tension peut être calibrée via le menu <em>« Tools-&gt;Calibration-&gt;Battery »</em>. Une boite de dialogue affiche alors deux champs, l’un contenant la mesure brute, l’autre vous permettant d’entrer la mesure calibrée. Pour la connaitre, mesurez simplement la tension de la batterie avec un voltmètre.</p>
<h2 id="calibration-des-capteurs-inertiels">Calibration des capteurs inertiels</h2>
<p>Comme expliqué dans l’article précédent, le pendule estime en permanence sa vitesse de rotation, ainsi que l’angle qu’il forme avec le sol, en s’aidant de capteurs de type gyroscope et accéléromètres. Ces capteurs ont bien sur leurs propres erreurs de mesure et la liste exhaustive de celles-ci est plutôt longue. La précision n’étant toutefois pas critique dans le cas qui nous occupe, seuls les biais et les erreurs d’échelle présentent un intérêt à être corrigés.</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/iPendulum/CSErrors.png" alt="Les erreurs principales entachant la conversion d&#39;une mesure sont l&#39;erreur d&#39;offset et l&#39;erreur de gain."/>
    </div>
    <a href="/images/iPendulum/CSErrors.png" itemprop="contentUrl"></a>
      <figcaption>
          <p>Les erreurs principales entachant la conversion d&#39;une mesure sont l&#39;erreur d&#39;offset et l&#39;erreur de gain.</p>
      </figcaption>
  </figure>
</div>

<p>Un biais est une erreur systématique constante qui affecte toutes les mesures de la même façon. Une manière simple de le corriger est de mettre le capteur dans une situation où il devrait indiquer zéro, puis de lire sa valeur de sortie. Cela est plutôt aisé pour le gyroscope, car il suffit de lire la sortie du capteur quand le pendule est au repos pour connaitre le biais. La situation est déjà moins simple pour les accéléromètres car une situation de repos nécessite de positionner le capteur selon un axe perpendiculaire à un plan horizontal. Cela est plus facile à dire qu’à faire car il est très difficile d’aligner parfaitement un capteur de cette façon. L’idée utilisée ici pour s’en sortir est de moyenner les valeurs des accéléromètres dans deux situations antisymétriques, de manière à ce que les déviations par rapport à l’horizontale se compensent mutuellement.</p>
<p>Au final, le biais du gyroscope est le plus simple à corriger, mais c’est aussi l’erreur qui a le plus gros impact. Un gyroscope mesure en effet une vitesse de rotation, dont l’intégration peut donner une idée de la position. Intégrer une erreur constante revient alors à obtenir une erreur sur la position qui croit sans fin. Les biais sur les accéléromètres ont une incidence plus faible car ils affectent directement la mesure de position. Une dernière remarque qui a son importance est que le biais d’un capteur gyroscopique à la furieuse tendance à dériver avec la température ou à varier lentement avec le temps.</p>
<p>L’erreur d’échelle affecte le gain du système. La valeur délivrée présente donc un gain non unitaire par rapport à la valeur exacte recherchée. Le gain du gyroscope n’est pas corrigé dans le pendule car il est nécessaire de disposer d’équipements spécifiques pour mettre le pendule en rotation à une vitesse bien précise dans le but de mesurer cette erreur de gain. Il est par contre tout à fait possible de corriger les gains des accéléromètres car nous disposons d’une valeur de référence toute prête :  la gravité. En positionnant le pendule à plat ou sur le flanc, les accéléromètres doivent mesurer soit une accélération nulle, soit une fraction bien précise de g.
Ne vous en faites pas si tout cela vous semble un peu complexe. Une procédure de calibration toute faites est disponible via le menu <em>« Tools-&gt;Calibration-&gt;IMU »</em>. Cette procédure requiert votre participation pour mettre le pendule dans des positions bien définies. Suivez simplement les instructions jusqu’au bout pour terminer la procédure.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Nous voici arrivé à la fin de cette série d’articles sur le développement d’un pendule inversé. J’espère avoir pu titiller votre curiosité avec ce gadget, mais aussi lever un coin de voile sur les méthodes de régulation modernes. Ce pendule n’a pas d’autre utilité en soi que d’amuser, d’intriguer, ou tout simplement de découvrir et d’expérimenter. Mais il ne faut pas perdre de vue que ce genre de techniques sont omniprésentes dans la vie quotidienne, que ce soit dans les objets que nous utilisons ou dans la nature. Les boucles de régulation sont à l’œuvre dans le fonctionnement de nos voitures, de nos systèmes de communication ou dans les avions ou les fusées afin de suivre une trajectoire stable. La vie regorge également de telles capacités, que ce soit au niveau des interactions entre protéines dans les cellules ou de tout autre paramètre biologique qui nécessite d’être régulé : température, pression sanguine, etc.</p>
<p>Les code source du pendule, que ce soit le micrologiciel ou la station sol, sont complètement ouverts. Si vous vous en sentez l’envie, c’est maintenant à vous de jouer …</p>
        </span>
      </div>
      <div class="f5 mid-gray">
      <br>
      N'hésitez pas à partager
      

<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjsgonsette.github.io%2fprojects%2fipendulum%2fpart3%2f" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=iPendulum - Pendule%20invers%c3%a9%2c%20part%203&amp;url=https%3a%2f%2fjsgonsette.github.io%2fprojects%2fipendulum%2fpart3%2f" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
    </div>
  </div>
</a>






<a class="resp-sharing-button__link" href="mailto:?subject=iPendulum - Pendule%20invers%c3%a9%2c%20part%203&amp;body=https%3a%2f%2fjsgonsette.github.io%2fprojects%2fipendulum%2fpart3%2f" target="_self" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fjsgonsette.github.io%2fprojects%2fipendulum%2fpart3%2f&amp;media=https://jsgonsette.github.io/&amp;description=iPendulum - Pendule%20invers%c3%a9%2c%20part%203" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.14.5C5.86.5 2.7 5 2.7 8.75c0 2.27.86 4.3 2.7 5.05.3.12.57 0 .66-.33l.27-1.06c.1-.32.06-.44-.2-.73-.52-.62-.86-1.44-.86-2.6 0-3.33 2.5-6.32 6.5-6.32 3.55 0 5.5 2.17 5.5 5.07 0 3.8-1.7 7.02-4.2 7.02-1.37 0-2.4-1.14-2.07-2.54.4-1.68 1.16-3.48 1.16-4.7 0-1.07-.58-1.98-1.78-1.98-1.4 0-2.55 1.47-2.55 3.42 0 1.25.43 2.1.43 2.1l-1.7 7.2c-.5 2.13-.08 4.75-.04 5 .02.17.22.2.3.1.14-.18 1.82-2.26 2.4-4.33.16-.58.93-3.63.93-3.63.45.88 1.8 1.65 3.22 1.65 4.25 0 7.13-3.87 7.13-9.05C20.5 4.15 17.18.5 12.14.5z"/></svg>
    </div>
  </div>
</a>


    </div>
    </article>
    <aside class="ph3 mt2 mt6-ns">
      







  <div class="bg-light-gray pa3">
    <ul>
      <li class="list b mb3">
        2 autres articles dans iPendulum
      </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/projects/ipendulum/part1/" class="link ph2 pv2 db black">
            Pendule inversé, part 1
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/projects/ipendulum/part2/" class="link ph2 pv2 db black">
            Pendule inversé, part 2
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/projects/ipendulum/part3/" class="link ph2 pv2 db black o-50">
            Pendule inversé, part 3
          </a>
        </li>
      
    </ul>
  </div>


    </aside>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://jsgonsette.github.io/" >
    &copy; 2020 Jean-Sébastien Gonsette
  </a>
  <p align="right">






  <a href="https://www.linkedin.com/in/jsgonsette/" class="link-transition linkedin link dib z-999 pt3 pt0-l mr2" title="LinkedIn link">
    <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

  </a>


  <a href="https://github.com/jsgonsette" class="link-transition github link dib z-999 pt3 pt0-l mr2" title="Github link">
    <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

  </a>

</p>
  </div>
</footer>

    <script src="https://jsgonsette.github.io/dist/app.bundle.js" async></script>

  </body>
</html>
